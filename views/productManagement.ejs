<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Pro Players</title>

  <!-- Bootstrap Core CSS -->
  <link href="css/vendors/bootstrap.min.css" rel="stylesheet">

  <!-- MetisMenu CSS -->
  <link href="css/vendors/metisMenu.min.css" rel="stylesheet">

  <!-- DataTables CSS -->
  <link href="css/vendors/dataTables/dataTables.bootstrap.css" rel="stylesheet">

  <!-- DataTables Responsive CSS -->
  <link href="css/vendors/dataTables/dataTables.responsive.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="css/vendors/startmin.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="css/vendors/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!--moment JS-->
  <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
      integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

  <link rel="stylesheet" href="https://unpkg.com/cropperjs/dist/cropper.css">
  <script src="https://unpkg.com/cropperjs"></script>
</head>   
<style>
  .table-description {
    max-width: 200px;
   
  }
  .size{
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
  }
</style>

<body>


  <!-- Navigation -->
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Pro Players</a>
    </div>

    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>

    <ul class="nav navbar-nav navbar-left navbar-top-links">
      <li><a href="#"><i class="fa fa-home fa-fw"></i> Website</a></li>
    </ul>

    <ul class="nav navbar-right navbar-top-links">
      <li class="dropdown navbar-inverse">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          <i class="fa fa-bell fa-fw"></i> <b class="caret"></b>
        </a>
        <ul class="dropdown-menu dropdown-alerts">
          <li>
            <a href="#">
              <div>
                <i class="fa fa-comment fa-fw"></i> New Comment
                <span class="pull-right text-muted small">4 minutes ago</span>
              </div>
            </a>
          </li>
          <li>
            <a href="#">
              <div>
                <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                <span class="pull-right text-muted small">12 minutes ago</span>
              </div>
            </a>
          </li>
          <li>
            <a href="#">
              <div>
                <i class="fa fa-envelope fa-fw"></i> Message Sent
                <span class="pull-right text-muted small">4 minutes ago</span>
              </div>
            </a>
          </li>
          <li>
            <a href="#">
              <div>
                <i class="fa fa-tasks fa-fw"></i> New Task
                <span class="pull-right text-muted small">4 minutes ago</span>
              </div>
            </a>
          </li>
          <li>
            <a href="#">
              <div>
                <i class="fa fa-upload fa-fw"></i> Server Rebooted
                <span class="pull-right text-muted small">4 minutes ago</span>
              </div>
            </a>
          </li>
          <li class="divider"></li>
          <li>
            <a class="text-center" href="#">
              <strong>See All Alerts</strong>
              <i class="fa fa-angle-right"></i>
            </a>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          <i class="fa fa-user fa-fw"></i> Akshay <b class="caret"></b>
        </a>
        <ul class="dropdown-menu dropdown-user">
          <li>
            <a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
          </li>
          <li>
            <a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
          </li>
          <li class="divider"></li>
          <li>
            <a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
          </li>
        </ul>
      </li>
    </ul>
    <!-- /.navbar-top-links -->
  </nav>

  <aside class="sidebar navbar-default" role="navigation">
    <div class="sidebar-nav navbar-collapse">
      <ul class="nav" id="side-menu">

        <li>
          <a href="adminPanel"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a>
        </li>
        <li>
          <a href="/user-management"><i class="fa fa-table fa-fw"></i> user-management</a>
        </li>

        <li>
          <a href="/order-management"><i class="fa fa-table fa-fw"></i> order-management</a>
      </li>

        <li>
          <a href="#"><i class="fa fa-files-o fa-fw"></i> Product-Management<span class="fa arrow"></span></a>
          <ul class="nav nav-second-level">
            <li>
              <a href="/product-management">Products</a>
            </li>
            <li>
              <a href="/category-management">Categories</a>
            </li>
            
          </ul>
          <!-- /.nav-second-level -->
        </li>
      </ul>
    </div>
    <!-- /.sidebar-collapse -->
  </aside>
  <!-- /.sidebar -->




  <form class="form-horizontal mx-auto" style="margin-top: 60px; margin-left: 50px;" method="post" action="/product-management" onsubmit="return validateForm()" enctype="multipart/form-data">
    <fieldset>

      <!-- Form Name -->
      <center>
        <legend>Product Management</legend>
      </center>

      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <div class="alert alert-info text-center" id="error-message-container" style="color: black;" role="alert"><%=message%></div>
  
        </div>
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="product_name">PRODUCT NAME</label>
        <div class="col-md-4">
          <input id="product_name" name="productName" placeholder="PRODUCT NAME" class="form-control input-md"
             type="text">

        </div>
      </div>

      <!-- Select Basic -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="product_categorie">PRODUCT CATEGORY</label>
        <div class="col-md-4">
            <select id="product_categorie" name="productCategory" class="form-control">
                <% categories.forEach(category => { %>
                    <option value="<%= category._id %>">
                        <%= category.categoryName %>
                    </option>
                <% }); %>
            </select>
        </div>
    </div>
    


      <div class="form-group">
        <label class="col-md-4 control-label" for="product_name">PUBLISHER</label>
        <div class="col-md-4">
          <input id="publisher_name" name="publisher" placeholder="PUBLISHER" class="form-control input-md"
             type="text">

        </div>
      </div>

      <div class="form-group row">
        <label class="col-md-4 control-label" for="product_name">SIZE</label>
        <div class="col-md-4">
            <input id="product_size" name="size" placeholder="SIZE" class="form-control input-md" type="number" oninput="convertSize()">
        </div>
        <div class="col-md-1">
            <select name="sizeUnit" id="sizeUnit" class="form-control size" onchange="convertSize()">
                <option value="MB">MB</option>
                <option value="GB">GB</option>
            </select>
        </div>
        <input type="hidden" name="convertedSize" id="convertedSize" value="">
    </div>
    
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="available_quantity">TOTAL QUANTITY</label>
        <div class="col-md-4">
          <input id="toal_quantity" name="totalQuantity" placeholder="TOTAL QUANTITY"
            class="form-control input-md" type="text">

        </div>
      </div>

      <!-- Textarea -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="product_description">PRODUCT DESCRIPTION</label>
        <div class="col-md-4">
          <textarea class="form-control" id="product_description" name="description"></textarea>
        </div>
      </div>




      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="online_date">RELEASED DATE</label>
        <div class="col-md-4">
          <input id="released_date" name="releasedDate" placeholder="RELEASED DATE" class="form-control input-md" 
            type="date">

        </div>
      </div>

      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="online_date">PRICE</label>
        <div class="col-md-4">
          <input id="product_price" name="price" placeholder="PRICE" class="form-control input-md"
            type="text">

        </div>
      </div>

          <!-- File Button -->
          <!-- Add this to your HTML form -->
<!-- <div class="form-group">
  <label class="col-md-4 control-label" for="filebutton">main_image</label>
  <div class="col-md-4">
      <input id="image_uploader" name="image" class="input-file" type="file" accept=".jpg, .jpeg, .png, .webp">
      <img id="imagePreview" src="#" alt="Preview" style="width: 200px; height: 200px;">
      <button id="cropButton" type="button">Crop Image</button>
       Add hidden input to store cropped image data 
      <input type="hidden" id="croppedImageData" name="croppedImage1" >
  </div>
</div> -->


<div class="form-group">
                    <label>Image</label>
                    <input
                      class="form-control"
                      type="file"
                      name="gameImage"
                      id="imageInput"
                      required
                    />
                    <img id="imagePreview" style="max-width: 100%" />
                    <div id="errorImage" style="color: red;"></div>

                  </div>

                  <div class="form-group">
                    <label>Auxillary Image</label>
                    <input
                      class="form-control"
                      type="file"
                      name="gameImage2"
                      id="imageInput2"
                      
                    />
                    <img id="imagePreview2" style="max-width: 100%" />
                    <div id="errorImage" style="color: red;"></div>

                  </div>




          <!-- File Button -->

              <div class="form-group ">
            <label class="col-md-4 control-label" for="filebutton">secondary_image</label>
            <div class="col-md-4 ">
              <input id="secondary_image_uploader" name="imageSecondary" class="input-file" type="file" accept=".jpg, .jpeg, .png, .webp">
              <p>(optional)</p>
            </div>
          </div>
          

          <!-- Button -->
          <div class="form-group">
            <label class="col-md-4 control-label" for="filebutton"></label>
            <div class="col-md-4">
              <button id="singlebutton" name="SUBMIT" class="btn btn-primary">SUBMIT</button>
            </div>
          </div>

    </fieldset>
  </form>

  <div id="page-wrapper" style="margin-left: 0px;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Tables</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12" >
                <div class="panel panel-default">
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="">
                                <thead>
                                    <tr>
                                        <th>productName</th>
                                        <th>productCategory</th>
                                        <th>publisher</th>
                                        <th>size</th>
                                        <th>totalQuantity</th>
                                      
                                        <th>releasedDate</th>
                                        <th>price</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% products.forEach(product => { %>
                                        <tr>
                                            <td><%= product.productName %></td>
                                            <td><%= product.productCategory ? product.productCategory.categoryName : 'Uncategorized' %></td>
                                            <td><%= product.publisher %></td>
                                            <td><%= product.size %> GB</td>
                                            <td><%= product.totalQuantity %></td>
                                            <input type="hidden" value="<%= product.releasedDate %>" class="hiddenDate">
                                            <td class="releasedDateCell"></td>
                                            <td><%= product.price %></td>
                                            <td><%= product.isListed ? 'Listed' : 'Unlisted' %></td>

                                            <td class="iconss">
                                              <a class="edit" href="/product-management/toggle-list/<%= product._id %>" title="<%= product.isListed ? 'Unlist' : 'List' %>" data-toggle="tooltip">
                                                <%= product.isListed ? 'Unlist' : 'List' %>
                                            </a>
                                            
                                            
                                                <a href="/product-management/edit/<%= product._id %>" >Edit</a>
                                            </td>
                                            

                                           </tr>
                                            <% }); %>
                                    
                                </tbody>
                                <div class="pagination-container">
                                  <ul class="pagination">
                                      <% for (let i = 1; i <= totalPages; i++) { %>
                                          <li class="<%= currentPage === i ? 'active' : '' %>">
                                              <a href="/product-management?page=<%= i %>"><%= i %></a>
                                          </li>
                                      <% } %>
                                  </ul>
                              </div>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



  <!-- jQuery -->
  <script src="/js/adminJs/jquery.min.js"></script>

  <!-- Bootstrap Core JavaScript -->
  <script src="/js/adminJs/bootstrap.min.js"></script>

  <!-- Metis Menu Plugin JavaScript -->
  <script src="/js/adminJs/metisMenu.min.js"></script>

  <!-- DataTables JavaScript -->
  <script src="/js/adminJs/dataTables/jquery.dataTables.min.js"></script>
  <script src="/js/adminJs/dataTables/dataTables.bootstrap.min.js"></script>

  <!-- Custom Theme JavaScript -->
  <script src="/js/adminJs/startmin.js"></script>

  <!--Moment JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

  <!-- Page-Level Demo Scripts - Tables - Use for reference -->
  <script>
    $(document).ready(function () {
      $('#dataTables-example').DataTable({
        responsive: true
      });
    });
  // Function to validate the form
  function validateForm() {
    var productName = document.getElementById('product_name').value.trim();
    var productCategory = document.getElementById('product_categorie').value;
    var publisher = document.getElementById('publisher_name').value.trim();
    var size = document.getElementById('product_size').value.trim();
    var totalQuantity = document.getElementById('toal_quantity').value;
    var description = document.getElementById('product_description').value.trim();
    var releasedDate = document.getElementById('released_date').value;
    var price = document.getElementById('product_price').value;
    var imageUploader = document.getElementById('image_uploader')


    // Clear previous error messages
    document.getElementById('error-message-container').innerHTML = '';

    // Perform your validation checks
      if (productName === '' || productCategory === '' || publisher === '' || size === '' || description === '' || releasedDate === '' || imageUploader === '') {
      displayErrorMessage('Please fill out all fields');
      return false;
    }

    // Check if totalQuantity is a number
    if (isNaN(totalQuantity|| totalQuantity < 0)) {
      displayErrorMessage('Total Quantity must be a non negative number');
      return false;
    }

    // Check if price is a number
    if (isNaN(price || price < 0)) {
      displayErrorMessage('Price must be a non negative number');
      return false;
    }
    if (price < 0){
      displayErrorMessage('Price must be a non negative number');
      return false;
    }
    if (totalQuantity < 0) {
      displayErrorMessage('quantity must be a non negative number');
      return false;
    }
        var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.webp)$/i;
        if (!allowedExtensions.exec(imageUploader.value)) {
          displayErrorMessage("Invalid file type. Please upload a valid image file.");
            return false;
        }
    // If all checks pass, the form is valid
    return true;
  }

  // Function to display error messages
  function displayErrorMessage(message) {
    var errorMessageContainer = document.getElementById('error-message-container');
    var errorMessage = document.createElement('div');
    errorMessage.className = 'alert alert-danger text-center';
    errorMessage.innerHTML = message;
    errorMessageContainer.appendChild(errorMessage);
  }



function convertSize() {
    // Get the input element, size unit element, and the hidden input for converted size
    var inputElement = document.getElementById('product_size');
    var sizeUnitElement = document.getElementById('sizeUnit');
    var convertedSizeElement = document.getElementById('convertedSize');
    
    // Parse the input value as a number
    var sizeValue = parseFloat(inputElement.value);

    // If the input is a valid number
    if (!isNaN(sizeValue)) {
        // Convert the size based on the selected unit
        var convertedSize = sizeUnitElement.value === 'MB' ? sizeValue / 1024 : sizeValue;
        convertedSize = convertedSize.toFixed(2);
        // Update the hidden input value with the converted size
        convertedSizeElement.value = convertedSize;
    }

}
 document.addEventListener("DOMContentLoaded", function () {
    var image = document.getElementById("croppedImage");
    var input = document.getElementById("imageInput");
    var croppedDataInput = document.getElementById("croppedImageData");

    var cropper = new Cropper(image, {
      aspectRatio: 16 / 9, // Set your desired aspect ratio
      viewMode: 1, // Set to 1 to restrict the crop box to the size of the canvas
      crop: function (event) {
        // Update the hidden input with cropped data
        croppedDataInput.value = JSON.stringify(cropper.getData());
        console.log("croppedImageData:", croppedDataInput.value);

      },
    });

    input.addEventListener("change", function (e) {
      var files = e.target.files;
      var reader = new FileReader();

      reader.onload = function () {
        // Set the image source and update the Cropper
        image.src = reader.result;
        cropper.replace(reader.result);
      };

      reader.readAsDataURL(files[0]);
    });
  });


  
  const serverDateElements = document.querySelectorAll('.hiddenDate');

// Loop through each element and update the corresponding .releasedDateCell
serverDateElements.forEach(serverDateElement => {
    const serverDate = serverDateElement.value;
    const formattedDate = moment(serverDate).format('DD-MM-YYYY');
    
    // Find the corresponding .releasedDateCell in the same row
    const releasedDateCell = serverDateElement.closest('tr').querySelector('.releasedDateCell');
    
    // Update the content of the td element with the formatted date
    releasedDateCell.innerText = formattedDate || 'unconvertable';
});
  </script>
</body>

</html>